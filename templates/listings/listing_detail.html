{% extends 'base.html' %}
{% load static %}

{% block title %}{{ listing.title }} - Classified Marketplace{% endblock %}

{% block content %}
<div class="listing-detail-container">
    <div class="listing-detail-header">
        <div>
            {% if listing.image %}
            <img src="{{ listing.image.url }}" alt="{{ listing.title }}" class="listing-detail-image">
            {% else %}
            <!-- Display a relevant image based on the listing title when no image is uploaded -->
            <div class="listing-detail-image" style="background-image: url('https://source.unsplash.com/600x400/?{{ listing.title|urlencode }}'); background-size: cover; background-position: center;">
            </div>
            {% endif %}
        </div>
        <div class="listing-detail-info">
            <h1>{{ listing.title }}</h1>
            <div class="listing-detail-price">{{ listing.price_display }}</div>
            <p><strong>Category:</strong> {{ listing.category.icon }} {{ listing.category.name }}</p>
            <p><strong>Seller:</strong> {{ listing.owner.username }}</p>
            <p><strong>Posted:</strong> {{ listing.created_at|date:"F d, Y" }}</p>
            
            <div class="listing-actions">
                {% if listing.owner != user %}
                <a href="{% url 'chat:start_chat' listing.pk %}" class="btn btn-primary">Contact Seller</a>
                {% else %}
                <a href="{% url 'listings:edit_listing' listing.pk %}" class="btn btn-secondary">Edit Listing</a>
                <a href="{% url 'listings:delete_listing' listing.pk %}" class="btn btn-danger">Delete Listing</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="listing-description-section">
        <h2>Description</h2>
        <p>{{ listing.description|linebreaks }}</p>
    </div>
</div>

{% if related_listings %}
<div style="margin-top: 3rem;">
    <h2>More from {{ listing.category.name }}</h2>
    <div class="listings-grid">
        {% for related in related_listings %}
        <a href="{% url 'listings:listing_detail' related.pk %}" class="listing-card">
        {% if related.image %}
        <img src="{{ related.image.url }}" alt="{{ related.title }}" class="listing-image">
        {% else %}
        <!-- Display a relevant image based on the listing title when no image is uploaded -->
        <div class="listing-image" style="background-image: url('https://source.unsplash.com/600x400/?{{ related.title|urlencode }}'); background-size: cover; background-position: center;">
        </div>
        {% endif %}
            <div class="listing-info">
                <h3 class="listing-title">{{ related.title }}</h3>
                <div class="listing-price">{{ related.price_display }}</div>
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}